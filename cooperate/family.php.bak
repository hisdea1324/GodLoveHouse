<?php
require_once($_SERVER['DOCUMENT_ROOT']."/include/include.php");
$field = trim($_REQUEST["field"]);
$keyword = trim($_REQUEST["keyword"]);
$page = trim($_REQUEST["page"]);
if ((strlen($page)==0)) {
	$page=1;
} 

// 선교사 정보
$m_Helper = new MemberHelper();
$m_Helper->setMissionListCondition($field, $keyword);
$missions = $m_Helper->getMissionListWithPageing($page);
$strPage = $m_Helper->makePagingMissionList($page);

showHeader("HOME > 후원 > 선교사 가족과 함께","sponsor","tit_0401.gif");
body();
showFooter();

function body() {
?>
	<!-- //content -->
	<div id="content">
		<!-- //search -->
		<form name="findFrm" id="findFrm" action="family.php" method="get">
		<div id="search">
			<img src="../images/board/img_search.gif" class="r10" align="absmiddle">
			<select name="field" id="field">
				<option value="B.name"<?php if (($field=="B.name")) { ?> selected<?php } ?>>지역</option>
				<option value="A.ngo"<?php if (($field=="A.ngo")) { ?> selected<?php } ?>>파송선교단체</option>
				<option value="A.church"<?php if (($field=="A.church")) { ?> selected<?php } ?>>파송교회</option>
			</select>
			<input type="text" name="keyword" id="keyword" style="width:150px" class="input" value="<?php echo $keyword;?>">
			<img src="../images/board/btn_search.gif" border="0" align="absmiddle" onclick="frmSubmit();" style="cursor:pointer;">
		</div>
		</form>
		<!-- search// -->

		<!-- //list -->
		<div class="bg_list">
			<table width="100%" border="0" cellpadding="0" cellspacing="0" class="board_list">
				<col width="7%" />
				<col width="20%" />
				<col width="20%" />
				<col />
				<col width="15%" />
				<tr>
					<th>ID</th>
					<th>사진</th>
					<th class="th01">지역</th>
					<th class="th01">이름</th>
					<th class="th01">파송단체</th>
				</tr>
<?php 
	if ((count($missions)==0)) {
?>
				<tr>
					<td colspan="5">리스트가 없습니다</td>
				</tr>
<?php 
	} else {
		for ($i=0; $i<=count($missions)-1; $i = $i+1) {
			$mission = $missions[$i];
?>
				<tr>
					<td><?php echo ($i+1);?></td>
					<td><a href="familyDetail.php?userid=<?php echo $mission->userid;?>"><img src="<?php echo $mission->Image;?>" width="120" height="75" border="0" class="img"></a></td>
					<td><?php echo $mission->Nation;?></td>
					<td class="ltd">
						<p class="b"><?php echo $mission->MissionName;?></p>
						<p>
<?php 
			if ((strlen($mission->Memo)<150)) {
				print $textFormat[$mission->Memo][1];
			} else {
				print substr($textFormat[$mission->Memo][1],0,150)."...";
			} 

?>
						</p>
					</td>
					<td><?php echo $mission->Ngo;?></td>
				</tr>
				<tr>
					<td colspan="5" class="total">
						<?php $count = $mission->FamilyCount;?>
						가족참여 회원수 : <?php echo $count[0];?> 명 / 정기후원 회원수 : <?php echo $count[1];?> 명
					</td>
				</tr>
<?php 
		}
	} 

?>
			</table>
		</div>
		<!-- list// -->

		<!-- //page -->
		<?php echo $strPage;?>
		<!-- page// -->
	</div>
	<!-- content// -->
<?php } ?>

<script type="text/javascript">
//<![CDATA[
	function frmSubmit() {
		var findFrm = document.getElementById("findFrm");
		findFrm.submit();
	}
//]]>
</script>
